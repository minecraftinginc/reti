<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EDFilms</title>

    <link rel="icon" href="Icona_Scheda.png" sizes="32x32">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <link rel="stylesheet" href="style.css">
    <style>

        .profile-container {
            text-align: center;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            top: 50%;
        }

        .profile-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
        }

        .file-input {
            display: none;
        }
    </style>
    

</head>

<body>

    
    <nav class="navbar navbar-expand-lg" style="background-color: #33006E; height: 12%">

        <div class="container-fluid" style="background-color: #33006E;">
            <a class="navbar-brand" href="#"><img src="Logo.png" alt="Bootstrap" width="120" height="90"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarScroll"
                aria-controls="navbarScroll" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarScroll">
                <ul class="navbar-nav me-auto my-2 my-lg-0 navbar-nav-scroll" style="--bs-scroll-height: 100px;">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="Home.html"
                            style="color: white;"><h4>Home</h4></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="nuovo.html"
                            style="color: white;"><h4>Film</h4></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false" style="color: white;">
                            <h4>Generi</h4>
                        </a>
                        <ul class="dropdown-menu">
                          <li class="nav-item">
                              <a style="color: white; text-align: center"><h6>Seleziona Generi:</h6></a>
                          </li>
                          <form action="categoriefilm.html" method="get" id="searchForm">   
                          <li>
                              <div class="form-check genre-item">
                                <input class="form-check-input" type="checkbox" id="azioneCheckbox" style="margin-left: -12px; margin-right: 5px">
                                <label class="form-check-label" for="azioneCheckbox">
                                  <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'azioneCheckbox')">Azione</a>
                                </label>
                              </div>
                            </li>
                            <li>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="avventuraCheckbox" style="margin-left: -12px; margin-right: 5px">
                                    <label class="form-check-label genre-item" for="avventuraCheckbox">
                                        <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'avventuraCheckbox')">Avventura</a>
                                    </label>
                                </div>
                            </li>
                            <li>
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="biograficoCheckbox" style="margin-left: -12px; margin-right: 5px">
                                <label class="form-check-label genre-item" for="biograficoCheckbox">
                                    <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'biograficoCheckbox')">Biografico</a>
                                </label>
                            </div>
                            </li>
                            <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="commediaCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="commediaCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'commediaCheckbox')">Commedia</a>
                                  </label>
                              </div>
                            </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="drammaticoCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="drammaticoCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'drammaticoCheckbox')">Drammatico</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="fantascienzaCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="fantascienzaCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'fantascienzaCheckbox')">Fantascienza</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="fantasyCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="fantasyCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'fantasyCheckbox')">Fantasy</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="horrorCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="horrorCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'horrorCheckbox')">Horror</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="musicaleCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="musicaleCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'musicaleCheckbox')">Musicale</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="poliziescoCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="poliziescoCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'poliziescoCheckbox')">Poliziesco</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="romanticoCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="romanticoCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'romanticoCheckbox')">Romantico</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="storicoCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="storicoCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'storicoCheckbox')">Storico</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="thrillerCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="thrillerCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'thrillerCheckbox')">Thriller</a>
                                  </label>
                              </div>
                          </li>
                          <li>
                              <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="westernCheckbox" style="margin-left: -12px; margin-right: 5px">
                                  <label class="form-check-label genre-item" for="westernCheckbox">
                                      <a class="dropdown-item" href="#" onclick="handleCheckboxClick(event, 'westernCheckbox')">Western</a>
                                  </label>
                              </div>
                          </li>
                              
                          <button type="button" id="searchButton" class="btn btn-outline-success" style="color: #FFFFFF; background: #33006E;" onmouseover="this.style.background='#FF00AD'" onmouseout="this.style.background='#33006E'">Applica Ricerca Dettagliata</button>
  
                          </form>
  
                      </li>
                  </ul>
                </ul>
                <form class="d-flex" role="search" onsubmit="event.preventDefault(); SEARCH()" method="POST">
                    <input class="form-control me-2" type="search" placeholder="Cerca..." aria-label="Search"
                        name="search_query" id="nome">
                    <button class="btn btn-outline-success" type="submit"
                        style="color:#FFFFFF">Ricerca</button>
                </form>
            </div>
        </div>
  
        <div class="nav-item dropdown">
            <a class="navbar-brand" href="#"><img src="Login1.png" alt="Bootstrap" width="60" height="60"
                    id="profileImage" style="margin-top: 5%"></a>
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                aria-expanded="false" style="color: white;">
                <h5>Accesso</h5>
            </a>
            <ul class="dropdown-menu ">
                <li><a class="dropdown-item" href="Login.html">Login</a></li>
                <li><a class="dropdown-item" href="Registrazione.html">Registrazione</a></li>
                <li id="profiloNavItem" style="display: none;"><a class="dropdown-item" href="Profilo.html">Profilo</a></li>
            </ul>
        </div>
  
    </nav>


    <div class="container mt-5" align="center">
        <div class="row justify-content-center">
            <div class="col-md-5">
                <form action="#" method="post" class="custom-form">
                    <h4 class="card-title text-center">Informazioni Utente:</h4><br>
                    <img src="" alt="Profile Image" class="profile-image" id="profile" onclick="openFileInput()">
                    <input type="file" accept="image/*" class="file-input" id="fileInput" onchange="displaySelectedImage()" >
                    <br>

                    <!-- Prima riga -->
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="name" class="form-label">Username:</label>
                                <span><input type="text" id="usernamePlaceholder" class="form-control" id="username" name="name" required readonly></span>
                                 
                            </div>
                            
                        </div>
  
                    <!-- Seconda riga -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">Nome:</label>
                                <input type="text" class="form-control" id="namePlaceholder" name="name" required readonly>
                            </div>
  
                            <div class="col-md-6">
                                <label for="surname" class="form-label">Cognome:</label>
                                <input type="text" class="form-control" id="surnamePlaceholder" name="surname" required readonly>
                            </div>
                        </div>
  
                    <!-- Terza riga (email) -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="name" class="form-label">EMAIL:</label>
                                <span><input type="text" id="emailPlaceholder" class="form-control" id="username" name="name" required readonly></span>
                            </div>
                        
                            <div class="col-md-6">
                                <label for="date" class="form-label" >Data Nascita:</label>
                                <input type="date" class="form-control" id="datePlaceholder" name="date" required readonly>
                            </div>
                        </div>
                          
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
    // Funzione per il controllo dell'età
    function checkAge() {
        // Ottieni l'elemento dell'input della data di nascita
        var dateInput = document.getElementById("date");

        // Ritarda l'esecuzione della validazione di 1500 millisecondi (1.5 secondi)
        setTimeout(function () {
            // Ottieni il valore della data di nascita
            var birthDate = new Date(dateInput.value);

            // Calcola l'età dell'utente
            var age = new Date().getFullYear() - birthDate.getFullYear();

            // Verifica se l'età è inferiore a 10 o superiore a 140
            if (age < 10 || age > 140) {
                // Svuota l'input della data di nascita
                dateInput.value = "";

                // Mostra un messaggio di errore all'utente
                alert("La data di nascita inserita non è valida. Si prega di verificare e riprovare.");
            }
        }, 1500); // Tempo di ritardo in millisecondi
    }

    // Aggiungi un listener all'input della data di nascita per chiamare la funzione checkAge()
    document.getElementById("date").addEventListener("input", checkAge);
});

window.onload = function() {
                const username = getParameterByName('username', window.location.href);
                showUser(username);
                if (username) {
                    document.getElementById('profiloNavItem').style.display = 'block';
                }
                // Add an event listener to each link in the navigation menu
                document.querySelectorAll('.navbar-nav a').forEach(link => {
                        // Append username as a query parameter to the href attribute
                        link.href += `?username=${encodeURIComponent(username)}`;
                    });
                function getParameterByName(name, url) {
                    if (!url) {
                        url = window.location.href;
                    }
                    name = name.replace(/[\[\]]/g, "\\$&");
                    const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                    const results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                }
                checkImagePresence(username);
            }

            function openFileInput() {
                document.getElementById('fileInput').click();
            }

            function getParameterByName(name, url) {
                    if (!url) {
                    url = window.location.href;
                    }
                    name = name.replace(/[\[\]]/g, "\\$&");
                    const regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)");
                    const results = regex.exec(url);
                    if (!results) return null;
                    if (!results[2]) return '';
                    return decodeURIComponent(results[2].replace(/\+/g, " "));
                }

                // Funzione per gestire la risposta del server e impostare l'attributo src dell'immagine
                function handleImageResponse(data) {
                    const profileImage = document.getElementById('profileImage');
                    const profile=document.getElementById('profile');
                    if (data.success && data.imagePresent) {
                        // Se la richiesta al server è avvenuta con successo e l'immagine è presente,
                        // imposta l'attributo src con l'URL dell'immagine
                        profileImage.src = `uploads/${data.image}`;
                        profileImage.style.display = 'block';
                        profile.src = `uploads/${data.image}`;
                        profile.style.display = 'block';
                    } else {
                        // Se c'è stato un errore o l'immagine non è presente, imposta l'attributo src con l'immagine predefinita
                        profileImage.src = 'uploads/user.png';
                        profileImage.style.display = 'block';
                        profile.src = 'uploads/user.png';
                        profile.style.display = 'block';
                    }
                }

                // Funzione per verificare la presenza dell'immagine nel server
                function checkImagePresence(username) {
                    // Effettua una richiesta fetch alla tua API per verificare la presenza dell'immagine
                    fetch(`http://127.0.0.1/api/checkimage?username=${username}`)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {console.log(data);
                            // Gestisci la risposta del server e imposta l'attributo src dell'immagine
                            handleImageResponse(data);
                        })
                        .catch(error => {
                            handleImageResponse({ success: false, imagePresent: false, username: null });
                        });
                }

                function displaySelectedImage() {
                    const fileInput = document.getElementById('fileInput');
                    const profileImage = document.getElementById('profileImage');
                    const profile = document.getElementById('profile');
                    const username = getParameterByName('username', window.location.href);

                    if (fileInput.files && fileInput.files[0]) {
                        const fileName = fileInput.files[0].name;

                        // Crea un oggetto JSON con i dati necessari
                        const jsonData = {
                            username: username,
                            imageFile: fileName
                        };

                        // Effettua una richiesta fetch alla tua route di upload
                        fetch('http://127.0.0.1/api/imageprofile', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(jsonData)
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            // Gestisci la risposta dal server se necessario
                            console.log(data);
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });

                        // Imposta l'immagine del profilo
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            profileImage.src = e.target.result;
                            profile.src=e.target.result;
                        };
                        reader.readAsDataURL(fileInput.files[0]);
                    }
                }



            function showUser(username) {
                // Prepare the data for the POST request
                console.log(username);
                let requestBody = {
                    username: username
                };

                // Convert data to JSON format
                let jsonString = JSON.stringify(requestBody);

                // Make a POST request to the showuser API endpoint
                fetch('http://127.0.0.1/api/showuser', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: jsonString
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(responseJson => {
                    // Handle the response data
                    console.log("ciao");
                    console.log(responseJson.name);

                    // Update UI with actual username and email
                    document.getElementById('usernamePlaceholder').value = responseJson.username;
                    document.getElementById('emailPlaceholder').value = responseJson.email;
                    document.getElementById('namePlaceholder').value = responseJson.name;
                    document.getElementById('surnamePlaceholder').value = responseJson.cognome;
                    const formattedDate = formatDate(responseJson.data);
                    console.log(formattedDate);
                    document.getElementById('datePlaceholder').value = formattedDate;
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Handle errors, e.g., display an error message to the user
                });
            }
            function formatDate(inputDate) {
                const dateObj = new Date(inputDate);
                
                // Extract year, month, and day components
                const year = dateObj.getFullYear();
                const month = (dateObj.getMonth() + 1).toString().padStart(2, '0'); // Months are zero-based
                const day = dateObj.getDate().toString().padStart(2, '0');

                // Format the date as "yyyy-MM-dd"
                const formattedDate = `${year}-${month}-${day}`;

                return formattedDate;
            }

    </script>
</body>

</html>
